pipeline {
    agent {
        label 'alma-ansible'
    }
    parameters {
        string(name: 'IP', defaultValue: '192.168.1.10', description: 'Enter IP')
        string(name: 'Playbook', defaultValue: 'test.yml', description: 'Enter Playbook Name')
    }
    stages {
        stage('Checkout and Pull') {
            steps {
                dir('$WORKSPACE/ansible-playbooks') {
                    git branch: 'main', url: 'https://github.com/DivakarK22/ansible-playbooks.git'
                }
            }
        }
        stage('Updating Inventory file') {
            steps {
                script {
                    def param1 = params.IP
                    def param2 = params.Playbook
                    // Define multi-line text
                    def multilineText = '''
                    [all:vars]
                    ansible_ssh_common_args='-o StrictHostKeyChecking=no'
                    [all]
                    ${IP} ansible_user=root ansible_password=123
                    '''.stripIndent()
                    
                    // Write multi-line text to a file
                    writeFile file: '/etc/ansible/hosts', text: multilineText
                    
                    // Verify the file content
                    echo "File content:"
                    sh "cat /etc/ansible/hosts"
                }
            }
        }
        stage('Tasks') {
            steps {
                sh 'ansible-playbook $WORKSPACE/jenkins-playbooks/${playbook}  || true'
            }
        }          
    }
}